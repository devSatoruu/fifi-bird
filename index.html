<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>FIFI: HORIZON FLIGHT ‚úàÔ∏è</title>

    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2280%22>‚úàÔ∏è</text></svg>">

    <style>
        :root {
            --p: #ff4d6d; --s: #00d2ff; --g: #00ff41; --y: #f1c40f;
            --day-bg: #74b9ff; --sunset-bg: #ff7675; --night-bg: #0a192f;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Segoe UI', sans-serif; overflow: hidden; touch-action: none; }

        body { background: #000; height: 100vh; width: 100vw; display: flex; justify-content: center; align-items: center; }

        #game-container {
            position: relative; width: 100vw; height: 100vh; max-width: 500px;
            background: var(--day-bg); transition: background 2s;
        }

        .top-ui {
            position: absolute; top: env(safe-area-inset-top, 20px); width: 100%;
            display: flex; justify-content: space-around; padding-top: 20px; z-index: 200;
        }

        .stat-box {
            background: rgba(0,0,0,0.6); padding: 10px 18px; border-radius: 25px;
            color: white; font-weight: bold; font-size: 1.1rem; backdrop-filter: blur(5px);
        }

        #plane {
            position: absolute; left: 60px; top: 50%; width: 50px; height: 50px;
            font-size: 45px; z-index: 100; display: flex; align-items: center; justify-content: center;
        }

        .obstacle {
            position: absolute; width: 80px; z-index: 5; background: #fff;
            border: 3px solid #333; border-radius: 8px;
        }

        .menu-overlay {
            position: absolute; inset: 0; background: rgba(0, 0, 0, 0.8);
            z-index: 300; display: flex; flex-direction: column; align-items: center;
            justify-content: center; color: white;
        }

        .btn-main {
            background: var(--p); color: white; padding: 15px 40px; border-radius: 30px;
            border: none; font-weight: 800; font-size: 1.5rem; margin-top: 20px;
        }
    </style>
</head>
<body onmousedown="handleInput(event)" ontouchstart="handleInput(event)">

<div id="game-container">
    <div id="celestial" style="position:absolute; top:80px; right:20%; font-size:80px;">‚òÄÔ∏è</div>
    <div class="top-ui">
        <div class="stat-box">üíñ <span id="wallet">0</span></div>
        <div class="stat-box">üìç <span id="distance">1000</span></div>
    </div>
    <div id="plane">‚úàÔ∏è</div>
    <div id="menu" class="menu-overlay">
        <h1 style="font-size: 3rem; color: var(--y);">FIFI FLIGHT</h1>
        <p>TAP TO BOUNCE</p>
        <button class="btn-main" onclick="startGame(event)">START</button>
    </div>
</div>

<script>
    const plane = document.getElementById('plane'),
        walletDisplay = document.getElementById('wallet'),
        distDisplay = document.getElementById('distance'),
        menu = document.getElementById('menu'),
        container = document.getElementById('game-container');

    let planeY, velocity, gameActive = false, distance = 1000, frame = 0, hearts = 0, obstacles = [];

    // --- FLAPPY PHYSICS CONSTANTS ---
    const GRAVITY = 0.4;        // Heavy fall
    const JUMP = -7.5;          // Sharp pop up
    const SCROLL_SPEED = 3.8;   // Fast movement
    const GAP = 220;            // Tight gaps for difficulty
    // --------------------------------

    function handleInput(e) {
        if (e.target.tagName === 'BUTTON') return;
        if (gameActive) {
            velocity = JUMP;
        }
    }

    function startGame(e) {
        e.stopPropagation();
        gameActive = true;
        menu.style.display = 'none';
        planeY = container.offsetHeight / 2;
        velocity = 0;
        distance = 1000;
        hearts = 0;
        frame = 0;
        walletDisplay.innerText = "0";
        document.querySelectorAll('.obstacle').forEach(el => el.remove());
        obstacles = [];
        loop();
    }

    function spawn() {
        const screenH = container.offsetHeight;
        const minPipeHeight = 100;
        const pipeH = Math.random() * (screenH - GAP - (minPipeHeight * 2)) + minPipeHeight;

        const top = document.createElement('div');
        top.className = 'obstacle';
        top.style.height = pipeH + 'px';
        top.style.top = '0';
        top.style.left = '100%';

        const bottom = document.createElement('div');
        bottom.className = 'obstacle';
        bottom.style.height = (screenH - pipeH - GAP) + 'px';
        bottom.style.bottom = '0';
        bottom.style.left = '100%';

        container.appendChild(top);
        container.appendChild(bottom);
        obstacles.push({ x: container.offsetWidth, h: pipeH, top, bottom });
    }

    function loop() {
        if (!gameActive) return;

        velocity += GRAVITY;
        planeY += velocity;

        // Tilt logic: nose up when jumping, nose down when falling
        let rotation = Math.max(-25, Math.min(velocity * 4, 90));
        plane.style.top = planeY + 'px';
        plane.style.transform = `rotate(${rotation}deg)`;

        // Death conditions
        if (planeY < 0 || planeY > container.offsetHeight - 40) return gameOver();

        if (frame++ % 80 === 0) spawn();

        for (let i = obstacles.length - 1; i >= 0; i--) {
            let o = obstacles[i];
            o.x -= SCROLL_SPEED;
            o.top.style.left = o.x + 'px';
            o.bottom.style.left = o.x + 'px';

            // Precise Collision
            if (o.x < 100 && o.x > 20) {
                if (planeY < o.h || planeY > (o.h + GAP - 40)) return gameOver();
            }

            if (o.x < -100) {
                o.top.remove(); o.bottom.remove();
                obstacles.splice(i, 1);
            }
        }

        if (frame % 40 === 0) {
            distance--;
            distDisplay.innerText = distance;
        }

        if (distance <= 0) return win();
        requestAnimationFrame(loop);
    }

    function gameOver() {
        gameActive = false;
        menu.innerHTML = `<h1 style="color:var(--p);">CRASHED!</h1><button class="btn-main" onclick="location.reload()">RETRY</button>`;
        menu.style.display = 'flex';
    }

    function win() {
        gameActive = false;
        menu.innerHTML = `<h1 style="color:var(--y);">YOU MADE IT! ‚ù§Ô∏è</h1><button class="btn-main" onclick="location.reload()">FLY AGAIN</button>`;
        menu.style.display = 'flex';
    }
</script>
</body>
</html>