<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>FIFI: HORIZON FLIGHT âœˆï¸</title>
    <style>
        :root {
            --p: #ff4d6d; --s: #00d2ff; --g: #00ff41; --y: #f1c40f;
            --day-bg: #74b9ff; --sunset-bg: #ff7675; --night-bg: #0a192f;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Segoe UI', sans-serif; overflow: hidden; }
        body { background: #000; height: 100vh; display: flex; justify-content: center; align-items: center; }

        #game-container {
            position: relative; width: 100%; max-width: 420px; height: 700px;
            background: var(--day-bg); border-radius: 40px; border: 4px solid rgba(255,255,255,0.3);
            box-shadow: 0 0 50px rgba(0,0,0,0.8);
            transition: background 2s ease-in-out;
        }

        #celestial {
            position: absolute; width: 120px; height: 120px; font-size: 100px;
            top: 60px; left: 80%; transform: translateX(-50%); z-index: 1;
            display: flex; align-items: center; justify-content: center;
        }
        .sun-glow { filter: drop-shadow(0 0 35px #f1c40f); }
        .moon-glow { filter: drop-shadow(0 0 35px #ffffff); }

        #star-container { position: absolute; inset: 0; opacity: 0; pointer-events: none; z-index: 0; transition: opacity 2s; }
        .star { position: absolute; background: white; border-radius: 50%; width: 2px; height: 2px; }

        .top-ui { position: absolute; top: 30px; width: 100%; display: flex; justify-content: space-around; align-items: center; z-index: 200; }
        .stat-box { background: rgba(0,0,0,0.6); padding: 8px 15px; border-radius: 20px; border: 1px solid rgba(255,255,255,0.2); backdrop-filter: blur(10px); color: white; font-weight: bold; }

        #pause-btn {
            background: rgba(255,255,255,0.2); border: 1px solid white; color: white;
            width: 45px; height: 45px; border-radius: 50%; cursor: pointer; font-size: 1.2rem;
            display: flex; align-items: center; justify-content: center;
        }

        #stage-announcer {
            position: absolute; width: 100%; top: 35%; text-align: center;
            background: transparent; color: white; z-index: 500; pointer-events: none;
            opacity: 0; transform: translateY(20px);
            transition: all 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        #stage-announcer.show { opacity: 1; transform: translateY(0); }
        #stage-announcer h2 { font-size: 1.4rem; color: var(--y); text-transform: uppercase; letter-spacing: 3px; margin-bottom: 5px; text-shadow: 0 2px 10px rgba(0,0,0,0.5); }
        #stage-announcer p { font-size: 1rem; font-style: italic; opacity: 0.9; text-shadow: 0 1px 5px rgba(0,0,0,0.5); }

        #plane { position: absolute; left: 50px; top: 300px; width: 50px; height: 50px; font-size: 40px; z-index: 100; display: flex; align-items: center; justify-content: center; }
        .shield-active { filter: drop-shadow(0 0 15px var(--g)); }
        .magnet-active { filter: drop-shadow(0 0 15px var(--s)); }

        .obstacle { position: absolute; width: 95px; z-index: 5; border-radius: 30px; background: linear-gradient(#fdfbfb, #ebedee); border: 2px solid white; display: flex; align-items: center; justify-content: center; color: #95a5a6; font-size: 1.5rem; transition: background 1s; }
        .item { position: absolute; width: 45px; height: 45px; display: flex; align-items: center; justify-content: center; font-size: 35px; z-index: 6; }

        .menu-overlay { position: absolute; inset: 0; background: rgba(0, 0, 0, 0.9); z-index: 300; display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; padding: 25px; color: white; }
        .btn-main { background: var(--p); color: white; padding: 18px 50px; border-radius: 50px; border: none; font-weight: 800; cursor: pointer; font-size: 1.3rem; margin-top: 15px; }
    </style>
</head>
<body onmousedown="handleInput()" ontouchstart="handleInput()">

<div id="game-container">
    <div id="star-container"></div>
    <div id="stage-announcer">
        <h2 id="stage-title">Clear Skies</h2>
        <p id="stage-desc">Relax and drift...</p>
    </div>
    <div id="celestial" class="sun-glow">â˜€ï¸</div>
    <div class="top-ui">
        <div class="stat-box">ğŸ’– <span id="wallet">0</span></div>
        <button id="pause-btn" onclick="togglePause(event)">â¸ï¸</button>
        <div class="stat-box">ğŸ“ <span id="distance">1000</span>mi</div>
    </div>
    <div id="plane">âœˆï¸</div>
    <div id="menu" class="menu-overlay">
        <h1 id="menu-title" style="color:var(--p);">FIFI misses you.</h1>
        <p>Fly to him.</p>
        <button class="btn-main" onclick="startGame()">START FLIGHT</button>
    </div>
</div>

<script>
    const plane = document.getElementById('plane'),
        walletDisplay = document.getElementById('wallet'),
        distDisplay = document.getElementById('distance'),
        menu = document.getElementById('menu'),
        container = document.getElementById('game-container'),
        celestial = document.getElementById('celestial'),
        starField = document.getElementById('star-container'),
        announcer = document.getElementById('stage-announcer'),
        stageTitle = document.getElementById('stage-title'),
        stageDesc = document.getElementById('stage-desc'),
        pauseBtn = document.getElementById('pause-btn');

    let planeY, velocity, gameActive, isPaused = false, distance = 1000, frame, animationId, hearts = 0, obstacles = [];
    let shieldTimer = 0, magnetTimer = 0, flightSpeed = 2.0, currentStage = -1;

    const stageData = [
        { name: "Clear Skies", desc: "A peaceful start â˜ï¸", icon: "âœˆï¸", obs: "â˜ï¸" },
        { name: "Whispering Winds", desc: "The clouds are waking up... ğŸŒ¬ï¸", icon: "âœˆï¸", obs: "â˜ï¸" },
        { name: "Cumulus Climb", desc: "Watch out for the wobbles! ğŸˆ", icon: "ğŸ•Šï¸", obs: "â˜ï¸" },
        { name: "Dusk Drifter", desc: "The sun is getting sleepy ğŸŒ…", icon: "ğŸš", obs: "â˜ï¸" },
        { name: "Starlight Path", desc: "Twinkle twinkle little star âœ¨", icon: "ğŸš", obs: "â­" },
        { name: "Galaxy Crossing", desc: "Way up in the deep blue ğŸŒŒ", icon: "ğŸ›¸", obs: "ğŸ«§" },
        { name: "Silver Lining", desc: "Almost there, stay strong! ğŸ’ª", icon: "ğŸ›¸", obs: "ğŸ«§" },
        { name: "Aurora Breeze", desc: "Magic is in the air ğŸŒˆ", icon: "ğŸš€", obs: "âœ¨" },
        { name: "Heaven's Gate", desc: "I can see the light! ğŸ•Šï¸", icon: "ğŸš€", obs: "âœ¨" },
        { name: "Homeward Bound", desc: "Final stretch to my heart! â¤ï¸", icon: "ğŸ’–", obs: "ğŸŒ¸" }
    ];

    for(let i=0; i<60; i++) {
        const s = document.createElement('div'); s.className = 'star';
        s.style.left = Math.random() * 100 + '%'; s.style.top = Math.random() * 100 + '%';
        starField.appendChild(s);
    }

    function handleInput() { if (gameActive && !isPaused) velocity = -4.2; }

    function togglePause(e) {
        e.stopPropagation();
        if (!gameActive) return;
        isPaused = !isPaused;
        pauseBtn.innerText = isPaused ? "â–¶ï¸" : "â¸ï¸";
        if (!isPaused) loop();
    }

    function announceStage() {
        let stageIdx = 9 - Math.floor(distance / 100);
        if (stageIdx !== currentStage && stageIdx >= 0 && stageIdx < 10) {
            currentStage = stageIdx;
            stageTitle.innerText = `Stage ${currentStage + 1}: ${stageData[currentStage].name}`;
            stageDesc.innerText = stageData[currentStage].desc;
            plane.innerText = stageData[currentStage].icon;
            announcer.classList.add('show');
            setTimeout(() => announcer.classList.remove('show'), 3000);
        }
    }

    function startGame() {
        gameActive = true; isPaused = false; menu.style.display = 'none';
        pauseBtn.innerText = "â¸ï¸";
        planeY = 300; velocity = 0; frame = 0; distance = 1000; currentStage = -1;
        shieldTimer = 0; magnetTimer = 0;
        plane.className = '';
        document.querySelectorAll('.obstacle, .item').forEach(el => el.remove());
        obstacles = []; announceStage(); loop();
    }

    function spawn() {
        if (isPaused) return;
        const h = Math.floor(Math.random() * 200) + 120; let gap = 290;
        let obsEmoji = stageData[currentStage]?.obs || "â˜ï¸";

        const top = document.createElement('div'); top.className = 'obstacle'; top.style.height = h + 'px'; top.style.top = '0'; top.style.left = '450px'; top.innerText = obsEmoji;
        const bottom = document.createElement('div'); bottom.className = 'obstacle'; bottom.style.height = (700-h-gap) + 'px'; bottom.style.bottom = '0'; bottom.style.left = '450px'; bottom.innerText = obsEmoji;

        if(obsEmoji === "ğŸ«§" || obsEmoji === "âœ¨") {
            top.style.background = "rgba(255,255,255,0.2)"; bottom.style.background = "rgba(255,255,255,0.2)";
        }

        container.appendChild(top); container.appendChild(bottom);
        let behavior = (distance <= 900 && Math.random() < 0.4) ? 'elevator' : 'static';
        obstacles.push({ type: 'pipe', top, bottom, x: 450, h, gap, behavior, offset: 0, dir: 1 });

        for(let i=0; i<3; i++) {
            const itemEl = document.createElement('div'); itemEl.className = 'item';
            let r = Math.random(), itemType = (r > 0.985) ? 'ğŸ›¡ï¸' : (r > 0.97 ? 'ğŸ§²' : 'ğŸ’–');
            itemEl.innerHTML = itemType;
            let itemY = h + (gap / 2) - 20 + (Math.random() * 60 - 30);
            container.appendChild(itemEl);
            obstacles.push({ type: 'item', el: itemEl, x: 500 + (i*75), worldY: itemY, kind: itemType });
        }
    }

    function loop() {
        if (!gameActive || isPaused) return;
        velocity += 0.16; planeY += velocity;
        plane.style.top = planeY + 'px';
        plane.style.transform = `rotate(${velocity * 3}deg)`;

        // Power-up Timer Logic
        if (shieldTimer > 0) { shieldTimer--; plane.classList.add('shield-active'); }
        else { plane.classList.remove('shield-active'); }

        if (magnetTimer > 0) { magnetTimer--; plane.classList.add('magnet-active'); }
        else { plane.classList.remove('magnet-active'); }

        let phase = Math.floor(distance / 333) % 3;
        if (phase === 0) { container.style.backgroundColor = "#74b9ff"; celestial.innerHTML = "â˜€ï¸"; starField.style.opacity = "0"; }
        else if (phase === 1) { container.style.backgroundColor = "#ff7675"; celestial.innerHTML = "ğŸŒ…"; starField.style.opacity = "0.3"; }
        else { container.style.backgroundColor = "#0a192f"; celestial.innerHTML = "ğŸŒ™"; starField.style.opacity = "1"; }

        if (planeY < -30 || planeY > 680) { gameOver(); return; }
        if (frame++ % 160 === 0) spawn();

        for (let i = obstacles.length - 1; i >= 0; i--) {
            let o = obstacles[i]; o.x -= flightSpeed;

            if (o.type === 'item') {
                if (magnetTimer > 0 && o.kind === 'ğŸ’–') {
                    let dx = 50 - o.x; let dy = planeY - o.worldY;
                    let dist = Math.sqrt(dx*dx + dy*dy);
                    if (dist < 250) { o.x += dx * 0.12; o.worldY += dy * 0.12; }
                }

                o.el.style.left = o.x + 'px'; o.el.style.top = o.worldY + 'px';
                if (o.x > 10 && o.x < 90 && Math.abs(planeY - o.worldY) < 50) {
                    if (o.kind === 'ğŸ’–') { hearts++; walletDisplay.innerText = hearts; }
                    else if (o.kind === 'ğŸ›¡ï¸') { shieldTimer = 600; } // ~10 seconds
                    else if (o.kind === 'ğŸ§²') { magnetTimer = 600; }
                    o.el.remove(); obstacles.splice(i, 1);
                }
            } else {
                if (o.behavior === 'elevator') { o.offset += 0.9 * o.dir; if (Math.abs(o.offset) > 55) o.dir *= -1; o.top.style.transform = `translateY(${o.offset}px)`; o.bottom.style.transform = `translateY(${o.offset}px)`; }
                o.top.style.left = o.x + 'px'; o.bottom.style.left = o.x + 'px';
                if (o.x > 40 && o.x < 100) {
                    if (planeY < (o.h + o.offset - 5) || planeY > (o.h + o.gap + o.offset - 45)) {
                        if (shieldTimer > 0) { shieldTimer = 0; o.top.remove(); o.bottom.remove(); obstacles.splice(i, 1); }
                        else { gameOver(); return; }
                    }
                }
            }
            if (o.x < -100) { if (o.type === 'item') o.el.remove(); else { o.top.remove(); o.bottom.remove(); } obstacles.splice(i, 1); }
        }

        if (frame % 45 === 0) { distance = Math.max(0, distance - 1); distDisplay.innerText = distance; announceStage(); }
        if (distance <= 0) { win(); return; }
        animationId = requestAnimationFrame(loop);
    }

    function gameOver() { gameActive = false; cancelAnimationFrame(animationId); menu.style.display = 'flex'; }
    function win() {
        gameActive = false; cancelAnimationFrame(animationId);
        menu.innerHTML = `<h1 style="color:var(--y); font-size: 2.5rem;">HOME! â¤ï¸</h1><p>You found FIFI!</p><button class="btn-main" onclick="location.reload()">FLY AGAIN</button>`;
        menu.style.display = 'flex';
    }
</script>
</body>
</html>